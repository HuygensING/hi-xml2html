!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.XMLio=t():e.XMLio=t()}(this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/dist/",r(r.s=2)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),o=[":empty",":not(",":first-child",":last-child",":nth-child(",":nth-last-child",":nth-of-type",":first-of-type",":last-of-type",":only-child"];t.wrapTree=function(e){return function(t){const r=document.createElement("section");return e.namespaces.forEach(e=>{t.setAttribute(`xmlns:${e}`,"http://example.com")}),r.appendChild(t),r}},t.unwrap=function(e){return e.firstChild},t.unwrapStringFunction=function(e){return new Function(`return ${e}`)()},t.selectElements=function(e,t){const r=t.indexOf(":");r>0&&o.every(e=>t.slice(r,r+e.length)!==e)&&(t=t.replace(/:/gu,n.COLON_REPLACE).toLowerCase());const s=e.querySelectorAll(t);return Array.from(s)},t.renameElement=function(e,t){const r=document.createElement(t);Array.from(e.attributes).forEach(t=>r.setAttribute(t.name,e.getAttribute(t.name))),r.className=e.className;let n=e.firstChild;for(;n;)r.appendChild(n.cloneNode(!0)),n=n.nextSibling;return r},t.replaceElement=function(e,t){null!=e.parentElement&&e.parentElement.replaceChild(t,e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);function o(e){return e.replace(/:/gu,t.COLON_REPLACE)}t.COLON_REPLACE="_-_-_-_";t.default=class{constructor(e){this.parserOptions=e,this.proxyElements=new Map,this.proxyAttributeElements=[]}addProxies(e){if(!this.parserOptions.handleNamespaces)return;const t=[];for(var r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT);r.nextNode();){const e=r.currentNode;for(const t of e.attributes){const r=t.name.indexOf(":");r>0&&"xmlns:"!==t.name.slice(0,r+1)&&(e.setAttribute(o(t.name),e.getAttribute(t.name)),this.proxyAttributeElements.push(e))}e.nodeName.indexOf(":")>0&&t.push(e)}return t.forEach(e=>{const t=n.renameElement(e,o(e.nodeName));this.proxyElements.set(t,e),n.replaceElement(e,t)}),e}removeProxies(e){return this.proxyAttributeElements.forEach(e=>{for(const r of e.attributes)r.name.indexOf(t.COLON_REPLACE)>0&&e.removeAttribute(r.name)}),Array.from(this.proxyElements.entries()).forEach(([e,t])=>{n.replaceElement(e,t)}),e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3);t.handlerDefaults=n.default;const o=r(4),s=r(5),c=r(6),a=r(0),l=r(1);t.default=class{constructor(e,t){this.parserOptions=t,this.transformers=[],this.trees=[],this.createOutput=(e=>{const t=this.trees.map(e=>this.proxyHandler.removeProxies(e)).map(a.unwrap).map(t=>"xml"===e.type?c.exportAsXml(t,e,this.parserOptions):"data"===e.type?c.exportAsData(t,e):"text"===e.type?c.exportAsText(t,e):"dom"===e.type?c.exportAsDOM(t,e):void 0);return t.length?1===t.length?t[0]:t:null}),this.parserOptions=Object.assign({handleNamespaces:!0,namespaces:[]},t),this.proxyHandler=new l.default(this.parserOptions);let r=document.createElement("root");this.parserOptions.namespaces.forEach(e=>r.setAttribute(`xmlns:${e}`,"http://example.com")),r.appendChild(e),r=this.proxyHandler.addProxies(r),this.root=[r.cloneNode(!0)],this.trees=[r]}export(e){null==e?e=[n.default.xml]:(Array.isArray(e)||(e=[e]),e=e.map(e=>Object.assign({},n.default[e.type],e))),this.applyTransformers();let t=e.map(this.createOutput);return t=1===t.length?t[0]:t,this.reset(),t}persist(){return this.applyTransformers(),this.root=this.trees.map(e=>e.cloneNode(!0)),this.reset(),this}reset(){this.transformers=[],this.trees=this.root.map(e=>e.cloneNode(!0))}applyTransformers(){this.transformers.forEach(e=>{"exclude"===e.type&&(this.trees=s.exclude(this.trees,e)),"replace"===e.type&&(this.trees=s.replace(this.trees,e)),"select"===e.type&&(this.trees=s.select(this.trees,e,this.parserOptions)),"change"===e.type&&(this.trees=s.change(this.trees,e)),"rename"===e.type&&(this.trees=s.rename(this.trees,e))})}addTransform(e){return e=Object.assign({},n.default[e.type],e),(0,o.default[e.type])(e)&&this.transformers.push(e),this}change(e,t){return this.addTransform({changeFunc:t,selector:e,type:"change"})}rename(e,t){return this.addTransform({newName:t,selector:e,type:"rename"})}exclude(e){return this.addTransform({selector:e,type:"exclude"})}replace(e,t,r=!0){return this.addTransform({removeSource:r,sourceSelectorFunc:t,targetSelector:e,type:"replace"})}select(e){return this.addTransform({selector:e,type:"select"})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={change:{active:!0,changeFunc:e=>e,selector:"",type:"change"},exclude:{active:!0,selector:[],type:"exclude"},rename:{active:!0,selector:"",newName:"",type:"rename"},replace:{active:!0,removeSource:!0,sourceSelectorFunc:()=>"",targetSelector:"",type:"replace"},select:{active:!0,selector:"",type:"select"},xml:{active:!0,type:"xml"},data:{active:!0,deep:!0,text:!0,type:"data"},text:{active:!0,join:" ",type:"text"},dom:{active:!0,type:"dom"}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={change:function(e){return e.changeFunc.length>0&&e.selector.length>0},exclude:function(e){return e.selector.length>0},rename:function(e){return e.selector.length>0&&e.newName.length>0},replace:function(e){return e.targetSelector.length>0&&e.sourceSelectorFunc.length>0},select:function(e){return e.selector.length>0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),o=r(1);t.exclude=function(e,t){return e.map(e=>((Array.isArray(t.selector)?t.selector:[t.selector]).forEach(t=>{n.selectElements(e,t).forEach(e=>e.parentNode.removeChild(e))}),e))},t.change=function(e,t){return e.map(e=>{const r=n.selectElements(e,t.selector);return Array.from(r).forEach(t.changeFunc),e})},t.rename=function(e,t){return e.map(e=>(n.selectElements(e,t.selector).forEach(e=>{const r=n.renameElement(e,t.newName);n.replaceElement(e,r)}),e))},t.replace=function(e,t){return e.map(e=>(function(e,t){const r=n.selectElements(e,t.targetSelector);r.length||console.log("WARNING",`No targets found for ${t.targetSelector}`);const s=[];return Array.from(r).forEach(r=>{s.push(r);const c=t.sourceSelectorFunc(r);let a=[];if(c instanceof Node)a.push(c);else{const t=n.selectElements(e,c);a=Array.from(t).filter(e=>-1===s.indexOf(e))}if(!a.length){const e=Array.from(r.attributes).reduce((e,t)=>t.name.indexOf(o.COLON_REPLACE)>-1?e:"class"===t.name&&""===t.value?e:e+=`[${t.name}=${t.value}]`,"");return void console.log("WARNING",`No sources (${c}) found for target: ${t.targetSelector}${e}`)}let[l,...u]=a;t.removeSource||(l=l.cloneNode(!0)),s.push(l),n.replaceElement(r,l),u.length&&u.filter(e=>-1===s.indexOf(e)).forEach(e=>{t.removeSource||(e=e.cloneNode(!0)),s.push(e),l.parentNode.insertBefore(e,l.nextSibling)})}),e})(e,t))},t.select=function(e,t,r){return e.map(e=>n.selectElements(e,t.selector).map(n.wrapTree(r))).reduce((e,t)=>e.concat(t),[])}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.exportAsXml=function(e,t,r){if(null==e)return"";const n=(new XMLSerializer).serializeToString(e);return r.namespaces.length||null!=e.attributes&&!Array.from(e.attributes).some(e=>/^xmlns/.test(e.name))?n.replace(/\sxmlns(:.*?)?="(.*?)"/gu,""):n},t.exportAsData=function(e,t){function r(e){const t=e,r=Array.from(t.attributes).reduce((e,r)=>(e[r.name]=t.getAttribute(r.name),e),{});return{name:t.nodeName.toLowerCase(),attributes:r,children:[]}}if(!t.deep)return r(e);const n=new Map,o=t.text?NodeFilter.SHOW_ALL:NodeFilter.SHOW_ELEMENT;var s=document.createTreeWalker(e,o);const c=r(s.currentNode);for(n.set(s.currentNode,c);s.nextNode();){let e;if(1===s.currentNode.nodeType)e=r(s.currentNode),n.set(s.currentNode,e);else if(3===s.currentNode.nodeType){if(!s.currentNode.textContent.trim().length)continue;e=s.currentNode.textContent}n.get(s.currentNode.parentElement).children.push(e)}return c},t.exportAsText=function(e,t){var r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT);const n=[],o=null!=r.currentNode.nodeValue?r.currentNode.nodeValue.trim():"";for(n.push(o);r.nextNode();)n.push(r.currentNode.nodeValue.trim());return n.filter(e=>null!=e&&e.length).join(t.join)},t.exportAsDOM=function(e,t){return e}}]).default});