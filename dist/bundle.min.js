!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.XMLio=t():e.XMLio=t()}(this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/dist/",r(r.s=2)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),o=[":empty",":not(",":first-child",":last-child",":nth-child(",":nth-last-child",":nth-of-type",":first-of-type",":last-of-type",":only-child"];function s(e,t,r){return o.some(e=>r.slice(t,t+e.length)===e)?e:n.COLON_REPLACE}t.unwrap=function(e){return e.firstChild},t.unwrapStringFunction=function(e){return new Function(`return ${e}`)()},t.selectElements=function(e,t){t.indexOf(":")>0&&(t=t.replace(/:/gu,s));const r=e.querySelectorAll(t);return Array.from(r)},t.renameElement=function(e,t,r){const n=e.createElement(r);Array.from(t.attributes).forEach(e=>n.setAttribute(e.name,t.getAttribute(e.name))),t.className.length&&(n.className=t.className);let o=t.firstChild;for(;o;)n.appendChild(o.cloneNode(!0)),o=o.nextSibling;return n},t.replaceElement=function(e,t){null!=e.parentElement&&e.parentElement.replaceChild(t,e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);function o(e){return e.replace(/:/gu,t.COLON_REPLACE)}function s(e,t){let r=0;for(;e!==t;)r+=1,e=e.parentNode;return r}t.COLON_REPLACE="_-_-_-_";t.default=class{constructor(e,t){this.parserOptions=t}addProxies(e){if(!this.parserOptions.handleNamespaces)return;const t=[];for(var r=e.createTreeWalker(e,NodeFilter.SHOW_ELEMENT);r.nextNode();){const n=r.currentNode;for(const e of n.attributes){const t=e.name.indexOf(":");t>0&&"xmlns:"!==e.name.slice(0,t+1)&&n.setAttribute(o(e.name),n.getAttribute(e.name))}n.nodeName.indexOf(":")>0&&t.push({depth:s(n,e),node:n})}return t.sort((e,t)=>t.depth-e.depth).forEach(t=>{const r=n.renameElement(e,t.node,o(t.node.nodeName));n.replaceElement(t.node,r)}),e}removeProxies(e){const r=[];for(var o=e.createTreeWalker(e,NodeFilter.SHOW_ELEMENT);o.nextNode();){const n=o.currentNode;for(const e of n.attributes)e.name.indexOf(t.COLON_REPLACE)>0&&n.removeAttribute(e.name);n.nodeName.indexOf(t.COLON_REPLACE)>0&&r.push({depth:s(n,e),node:n})}return r.sort((e,t)=>t.depth-e.depth).forEach(r=>{const o=n.renameElement(e,r.node,function(e){const r=new RegExp(t.COLON_REPLACE,"ug");return e.replace(r,":")}(r.node.nodeName));n.replaceElement(r.node,o)}),e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3);t.handlerDefaults=n.default;const o=r(4),s=r(5),c=r(6),a=r(0),l=r(1);t.default=class{constructor(e,t){this.doc=e,this.parserOptions=t,this.transformers=[],this.trees=[],this.createOutput=(e=>{const t=this.trees.map(e=>this.proxyHandler.removeProxies(e)).map(t=>"xml"===e.type?c.exportAsXml(t,e,this.parserOptions):"data"===e.type?c.exportAsData(t,e):"text"===e.type?c.exportAsText(t,e):"dom"===e.type?c.exportAsDOM(t,e):void 0);return t.length?1===t.length?t[0]:t:null}),this.parserOptions=Object.assign({handleNamespaces:!0,namespaces:[]},t),this.proxyHandler=new l.default(e,this.parserOptions),e=this.proxyHandler.addProxies(e),this.root=[e.cloneNode(!0)],this.trees=[e]}export(e){null==e?e=[n.default.xml]:(Array.isArray(e)||(e=[e]),e=e.map(e=>Object.assign({},n.default[e.type],e))),this.applyTransformers();let t=e.map(this.createOutput);return t=1===t.length?t[0]:t,this.reset(),t}persist(){return this.applyTransformers(),this.root=this.trees.map(e=>e.cloneNode(!0)),this.reset(),this}reset(){this.transformers=[],this.trees=this.root.map(e=>e.cloneNode(!0))}renameTransformer(e,t){return e.map(e=>(a.selectElements(e,t.selector).forEach(e=>{const r=a.renameElement(this.doc,e,t.newName);a.replaceElement(e,r)}),e))}selectTransformer(e,t,r){return e.map(e=>a.selectElements(e,t.selector).map(t=>{const r=e.cloneNode(!0);return r.replaceChild(e,r.documentElement),r})).reduce((e,t)=>e.concat(t),[])}applyTransformers(){this.transformers.forEach(e=>{"exclude"===e.type&&(this.trees=s.exclude(this.trees,e)),"replace"===e.type&&(this.trees=s.replace(this.trees,e)),"select"===e.type&&(this.trees=this.selectTransformer(this.trees,e,this.parserOptions)),"change"===e.type&&(this.trees=s.change(this.trees,e)),"rename"===e.type&&(this.trees=this.renameTransformer(this.trees,e))})}addTransform(e){return e=Object.assign({},n.default[e.type],e),(0,o.default[e.type])(e)&&this.transformers.push(e),this}change(e,t){return this.addTransform({changeFunc:t,selector:e,type:"change"})}rename(e,t){return this.addTransform({newName:t,selector:e,type:"rename"})}exclude(e){return this.addTransform({selector:e,type:"exclude"})}replace(e,t,r=!0){return this.addTransform({removeSource:r,sourceSelectorFunc:t,targetSelector:e,type:"replace"})}select(e){return this.addTransform({selector:e,type:"select"})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={change:{active:!0,changeFunc:e=>e,selector:"",type:"change"},exclude:{active:!0,selector:[],type:"exclude"},rename:{active:!0,selector:"",newName:"",type:"rename"},replace:{active:!0,removeSource:!0,sourceSelectorFunc:()=>"",targetSelector:"",type:"replace"},select:{active:!0,selector:"",type:"select"},xml:{active:!0,type:"xml"},data:{active:!0,deep:!0,text:!0,type:"data"},text:{active:!0,join:" ",type:"text"},dom:{active:!0,type:"dom"}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={change:function(e){return e.changeFunc.length>0&&e.selector.length>0},exclude:function(e){return e.selector.length>0},rename:function(e){return e.selector.length>0&&e.newName.length>0},replace:function(e){return e.targetSelector.length>0&&e.sourceSelectorFunc.length>0},select:function(e){return e.selector.length>0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),o=r(1);t.exclude=function(e,t){return e.map(e=>((Array.isArray(t.selector)?t.selector:[t.selector]).forEach(t=>{n.selectElements(e,t).forEach(e=>e.parentNode.removeChild(e))}),e))},t.change=function(e,t){return e.map(e=>{const r=n.selectElements(e,t.selector);return Array.from(r).forEach(t.changeFunc),e})},t.replace=function(e,t){return e.map(e=>(function(e,t){const r=n.selectElements(e,t.targetSelector);r.length||console.log("WARNING",`No targets found for ${t.targetSelector}`);const s=[];return Array.from(r).forEach(r=>{s.push(r);const c=t.sourceSelectorFunc(r);let a=[];if(c instanceof Node)a.push(c);else{const t=n.selectElements(e,c);a=Array.from(t).filter(e=>-1===s.indexOf(e))}if(!a.length){const e=Array.from(r.attributes).reduce((e,t)=>t.name.indexOf(o.COLON_REPLACE)>-1?e:"class"===t.name&&""===t.value?e:e+=`[${t.name}=${t.value}]`,"");return void console.log("WARNING",`No sources (${c}) found for target: ${t.targetSelector}${e}`)}let[l,...u]=a;t.removeSource||(l=l.cloneNode(!0)),s.push(l),n.replaceElement(r,l),u.length&&u.filter(e=>-1===s.indexOf(e)).forEach(e=>{t.removeSource||(e=e.cloneNode(!0)),s.push(e),l.parentNode.insertBefore(e,l.nextSibling)})}),e})(e,t))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.exportAsXml=function(e,t,r){return null==e?"":(new XMLSerializer).serializeToString(e)},t.exportAsData=function(e,t){function r(e){const t=Array.from(e.attributes).reduce((t,r)=>(t[r.name]=e.getAttribute(r.name),t),{});return{name:e.nodeName.toLowerCase(),attributes:t,children:[]}}if(!t.deep)return r(e.documentElement);const n=new Map,o=t.text?NodeFilter.SHOW_ALL:NodeFilter.SHOW_ELEMENT;var s=e.createTreeWalker(e,o);const c=r(s.currentNode);for(n.set(s.currentNode,c);s.nextNode();){let e;if(1===s.currentNode.nodeType)e=r(s.currentNode),n.set(s.currentNode,e);else if(3===s.currentNode.nodeType){if(!s.currentNode.textContent.trim().length)continue;e=s.currentNode.textContent}n.get(s.currentNode.parentElement).children.push(e)}return c},t.exportAsText=function(e,t){var r=e.createTreeWalker(e,NodeFilter.SHOW_TEXT);const n=[],o=null!=r.currentNode.nodeValue?r.currentNode.nodeValue.trim():"";for(n.push(o);r.nextNode();)n.push(r.currentNode.nodeValue.trim());return n.filter(e=>null!=e&&e.length).join(t.join)},t.exportAsDOM=function(e,t){return e}}]).default});